<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    </script>
    <meta charset="utf-8">
    <title>Testing raven</title>
  </head>
  <body>
    <h1>Testing raven on a real DOM</h1>
    <script type='module'>
      import raven from './src/index.js'

      window.raven = raven

      console.log('raven', raven)

      const store = {
        location: {
          country: 'Italy',
          city: 'Rome',
          continent: 'Europe'
        },
        personal: {
          name: 'Vivian',
          favoriteColor: 'yellow',
          favoriteNumber: 3,
          dislikes: [
            "loud noise",
            "veggies"
          ],
          email: 'nani@example.com'
        },
        family: {
          father: 'daddy',
          mother: 'mommy'
        }
      }
      raven.load(store)
    </script>

    <h2>Testing push</h2>
    <p>Anything typed in this field is reflected on the store.</p>
    <label>
      Favorite color: <input id="color" name="color">
    </label>
    <script type='module'>
      const { raven } = window
      const colorInput = document.querySelector('#color')
      raven.push(
        {
          target: colorInput,
          prop: 'value'
        },
        {
          personal: 'favoriteColor'
        }
      )
    </script>

    <h2>Testing subscribe</h2>
    <p>The value reflected on the store is reflected back here.</p>
    <div id="out-color">...</div>
    <script type="module">
      const { raven } = window
      const colorOutput = document.querySelector('#out-color')
      raven.subscribe({ personal: 'favoriteColor' },
        value => colorOutput.textContent = value
      )
    </script>

    <h2>Testing pull</h2>
    <p>The random number is set to the store and reflected back to the (disabled) input.</p>
    <div>Random generated value: <span id="random-num">...</span></div>
    <label>
      Favorite number: <input id="number-input" name="number-input" disabled>
    </label>
    <script type="module">
      const { raven } = window
      const randomNumber = () => Math.floor(Math.random() * 100)
      const randomNumInput = document.querySelector('#random-num')

      raven.subscribe({ personal: 'favoriteNumber' },
        value => randomNumInput.textContent = value
      )

      setInterval(function() {
        raven.set(
          {
            personal: {
              favoriteNumber: randomNumber()
            }
          }
        )}, 800)

      raven.pull({ personal: 'favoriteNumber' },
        {
          target: document.querySelector('#number-input'),
          prop: 'value'
        }
      )
    </script>

    <h2>Testing sync</h2>
    <p>The input and the store are kept in sync in one command.</p>
    <label>
      Name: <input name="name" id="input-name">
    </label>
    <div>Value in store: <span id="output-name">...</span></div>
    <script type="module">
      const { raven } = window
      raven.sync(
        { personal: 'name' },
        {
          target: document.querySelector('#input-name'),
          prop: 'value'
        }
      )
      raven.subscribe({ personal: 'name' }, function (value) {
        document.querySelector('#output-name').textContent = value
      })
    </script>
  </body>
</html>
