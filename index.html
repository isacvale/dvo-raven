<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    </script>
    <meta charset="utf-8">
    <title>Testing raven</title>
  </head>
  <body>
    <h1>Hello world!</h1>
    <input placeholder="type a color here" type="text">
    <input type="number">
    <h2></h2>
    <input type="search">
    <input type="email">



    <script type="module">

      /*
        Milestone 0
        Importing and giving access to developer console.
      */

      import raven from './raven.mjs'
      window.raven = raven

      /*
        Milestone 1
        Creating a store and loading into raven.
      */

      window.store = {
        location: {
          country: 'Italy',
          city: 'Rome',
          continent: 'Europe'
        },
        personal: {
          name: 'Vivian',
          favoriteColor: 'yellow',
          dislikes: [
            "loud noise",
            "veggies"
          ],
          email: 'nani@example.com'
        },
        family: {
          father: 'daddy',
          mother: 'mommy'
        }
      }
      raven.load(store)

      /*
        Milestone 2
        Subscribing a callback to a store property.
      */

      const callBack = newValue => {
        console.log('>>> Callback')
        console.log( newValue || "no new value provided")
        // document.querySelector('h1').textContent = newValue || "no new value provided"
      }
      raven.subscribe({
        location: "city"
      }, () => callBack("location/city has changed") )

      raven.subscribe({
        location: "country",
        personal: null
      }, () => callBack("location/country or personal has changed"))

      /*
        Milestone 3
        Changing the store state with the "set" method will cause all relevaant callbacks to fire.
      */

      raven.set({
        location: {
          country: 'Scotland',
          city: 'Edinburgh'
        }
      })
      raven.set({
        personal: {
          name: "Viviana"
        }
      })
      raven.set({
        location: {
          continent: "North America"
        }
      })

      /*
        Milestone 4
        Using method "push" will make it so changing a local property will automatically reflect on state. When used with an HTMLElement, it will automatically bind events to keep the store up to date.
      */

      let container = {}
      window.container = container
      container['nickname'] = "Nani"
      const inputText = document.querySelector('input[type="text"]')
      const inputNumber = document.querySelector('input[type="number"]')

      // From a variable
      raven.push({target: container, prop: "nickname"},
        {
          personal: "name",
          location: "dreamland"
        },
        value => "Smooch, "+value+"!"
      )
      container.nickname = "Vivi"

      // From inputs
      raven.push({target: inputText},
        {
          personal: 'favoriteColor'
        },
        value => "Cool color, "+value+"!"
      )
      raven.push({target: inputNumber},
        {
          personal: 'favoriteNumber'
        },
        value => +value+10000
      )

      /*
        Milestone 5
        Using method "pull" will make a variable adapts automatically to changes to store.
      */
      const family = {
        father: 'me'
      }
      window.family = family
      raven.pull({family: 'father'},
        {
          target: family,
          prop: 'father'
        }, value => value+'!')

      const h2 = document.querySelector('h2')
      raven.pull({family: 'father'},
      {
        target: h2,
        prop: 'textContent'
      }, value => '-'+value+'...')      
      const search = document.querySelector('input[type="search"]')
      raven.pull({family: 'father'},
      {
        target: search,
        prop: 'value'
      }, value => '-'+value+'...')



      /*
        Milestone 6
        Using method "sync" will automatically apply push and pull
      */
      family.mother = 'her'

      raven.sync({family: "mother"}, {target: family, prop:"mother"})

      const email = document.querySelector('input[type="email"]')
      raven.sync(
        {personal: "email"},
        {target: email, prop:"value"},
        value => value.replace('@example.com',''),
        value => [value, '@example.com'].join('')
        )

    </script>
  </body>
</html>
